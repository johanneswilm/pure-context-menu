{
  "version": 3,
  "sources": ["easy-context-menu.js"],
  "sourcesContent": ["\"use strict\";\n\nlet globalListenerSet = false;\nlet baseOptions = {\n  contextMenuClass: \"easy-context-menu\",\n  dropdownClass: \"dropdown-menu\",\n  dividerClass: \"dropdown-divider\",\n  itemClass: \"dropdown-item\",\n  zIndex: \"9999\",\n  preventCloseOnClick: false,\n};\n\n/**\n * Easily manage context menus\n * Works out of the box with bootstrap css\n */\nclass EasyContextMenu {\n  _el;\n  _items;\n  _options;\n  _currentEvent;\n\n  /**\n   * @param {HTMLElement} el\n   * @param {object} items\n   * @param {object} opts\n   */\n  constructor(el, items, opts) {\n    this._items = items;\n    this._el = el;\n\n    this._options = Object.assign(baseOptions, opts);\n\n    // bind the menu\n    el.oncontextmenu = this._onShowContextMenu;\n\n    // close if the user clicks outside of the menu\n    if (!globalListenerSet) {\n      document.addEventListener(\"click\", this._onDocumentClick);\n      globalListenerSet = true;\n    }\n  }\n\n  /**\n   * @param {object} opts\n   */\n  static updateDefaultOptions(opts) {\n    baseOptions = Object.assign(baseOptions, opts);\n  }\n\n  /**\n   * @returns {object}\n   */\n  static getDefaultOptions() {\n    return baseOptions;\n  }\n\n  /**\n   * Create the menu\n   * @returns {HTMLElement}\n   */\n  _buildContextMenu = () => {\n    const contextMenu = document.createElement(\"div\");\n    contextMenu.style.minWidth = \"120px\";\n    contextMenu.style.maxWidth = \"240px\";\n    contextMenu.style.display = \"block\";\n    contextMenu.classList.add(this._options.contextMenuClass);\n    contextMenu.classList.add(this._options.dropdownClass);\n\n    for (const item of this._items) {\n      const child = document.createElement(\"li\");\n      if (item === \"-\") {\n        const divider = document.createElement(\"hr\");\n        divider.classList.add(this._options.dividerClass);\n        child.appendChild(divider);\n      } else {\n        const link = document.createElement(\"a\");\n        link.innerText = item.label;\n        link.style.cursor = \"pointer\";\n        link.style.whiteSpace = \"normal\";\n        link.classList.add(this._options.itemClass);\n        child.appendChild(link);\n      }\n\n      contextMenu.appendChild(child);\n    }\n    return contextMenu;\n  };\n\n  /**\n   * Normalize the context menu position so that it won't get out of bounds\n   * @param {number} mouseX\n   * @param {number} mouseY\n   * @param {HTMLElement} contextMenu\n   */\n  _normalizePozition = (mouseX, mouseY, contextMenu) => {\n    const scope = this._el;\n    const offset = 5;\n\n    // compute what is the mouse position relative to the container element (scope)\n    const bounds = scope.getBoundingClientRect();\n\n    const scopeX = mouseX - bounds.left;\n    const scopeY = mouseY - bounds.top;\n\n    // check if the element will go out of bounds\n    const outOfBoundsOnX = scopeX + contextMenu.clientWidth > scope.clientWidth;\n    const outOfBoundsOnY = scopeY + contextMenu.clientHeight > scope.clientHeight;\n\n    let normalizedX = mouseX;\n    let normalizedY = mouseY;\n\n    // normalize on X\n    if (outOfBoundsOnX) {\n      normalizedX = bounds.left + scope.clientWidth - contextMenu.clientWidth - offset;\n    }\n\n    // normalize on Y\n    if (outOfBoundsOnY) {\n      normalizedY = bounds.top + scope.clientHeight - contextMenu.clientHeight - offset;\n    }\n\n    return { normalizedX, normalizedY };\n  };\n\n  _removeExistingContextMenu = () => {\n    document.querySelector(`.${this._options.contextMenuClass}`)?.remove();\n  };\n\n  _bindCallbacks = (contextMenu) => {\n    this._items.forEach((menuItem, index) => {\n      if (menuItem === \"-\") {\n        return;\n      }\n\n      const htmlEl = contextMenu.children[index];\n\n      htmlEl.onclick = () => {\n        menuItem.callback(this._currentEvent);\n\n        // do not close the menu if set\n        const preventCloseOnClick = menuItem.preventCloseOnClick ?? this._options.preventCloseOnClick ?? false;\n        if (!preventCloseOnClick) {\n          this._removeExistingContextMenu();\n        }\n      };\n    });\n  };\n\n  /**\n   * @param {MouseEvent} event\n   */\n  _onShowContextMenu = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    // Store event for callbakcs\n    this._currentEvent = event;\n\n    // the current context menu should disappear when a new one is displayed\n    this._removeExistingContextMenu();\n\n    // build and show on ui\n    const contextMenu = this._buildContextMenu();\n    document.querySelector(\"body\").append(contextMenu);\n\n    // set the position\n    const { clientX: mouseX, clientY: mouseY } = event;\n    const { normalizedX, normalizedY } = this._normalizePozition(mouseX, mouseY, contextMenu);\n    contextMenu.style.position = \"absolute\";\n    contextMenu.style.zIndex = this._options.zIndex;\n    contextMenu.style.top = `${normalizedY}px`;\n    contextMenu.style.left = `${normalizedX}px`;\n\n    // disable context menu for it\n    contextMenu.oncontextmenu = (e) => e.preventDefault();\n\n    // bind the callbacks on each option\n    this._bindCallbacks(contextMenu);\n  };\n\n  /**\n   * Used to determine if the user has clicked outside of the context menu and if so to close it\n   * @param {MouseEvent} event\n   */\n  _onDocumentClick = (event) => {\n    const clickedTarget = event.target;\n    if (clickedTarget.closest(`.${this._options.contextMenuClass}`)) {\n      return;\n    }\n    this._removeExistingContextMenu();\n  };\n\n  /**\n   * Remove all the event listeners that were registered for this feature\n   */\n  off() {\n    document.removeEventListener(\"click\", this._onDocumentClick);\n    globalListenerSet = false;\n    this._el.oncontextmenu = null;\n  }\n}\n\nexport default EasyContextMenu;\n"],
  "mappings": "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",
  "names": []
}
